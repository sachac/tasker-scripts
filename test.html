<html>
    <head>
        <title>Sacha's personal tracking interface</title>
        <style type="text/css">
         button { padding: 20px; font-size: large; width: 45%; display: inline-block  }
         #library-books li { padding: 20px; width: 100%; border: 1px solid #ccc; list-style-type: none; margin-left: 0 }
         #library-books { list-style-time: none; margin-left: 0; padding-left: 0 }
         .due { color: red; font-weight: bold }
         .due-date { font-size: small }
         .nonfiction { background-color: lightblue }
         .fiction { background-color: lightgreen }
         </style>
        <script type="text/javascript" src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
    </head>
    <body>
        <div id="feedback"></div>
        <!-- For making it easy to track things -->
        <div class="screen" id="main-screen">
            <button class="note">Do</button>
            <button class="note">Think</button>
            <button class="note">Note</button>
            <button class="note">Journal</button>
            <button id="library">Library</button>
            <button class="switch-screen" data-screen="track-screen">Track</button>
            <button class="switch-screen" data-screen="play-screen">Play</button>
            <button class="switch-screen" data-screen="eat-screen">Eat</button>
            <button class="switch-screen" data-screen="energy-screen">Energy</button>
            <button id="reload">Reload</button>
        </div>
        <div class="screen" id="library-screen">
            <button class="update-qa">Nonfiction</button>
            <button class="update-qa">Play Fiction</button>

            <ul id="library-books">
            </ul>
            <button class="switch-screen"
                    data-screen="main-screen">Back</button>
        </div>
        <div class="screen" id="play-screen">
            <button class="play">Persona 3</button>
            <button class="play">Ni No Kuni</button>
            <button class="play">Hobbit</button>
            <button class="switch-screen"
                    data-screen="main-screen">Back</button>
        </div>
        <div class="screen" id="energy-screen">
            <button class="energy">5</button><br />
            <button class="energy">4</button><br />
            <button class="energy">3</button><br />
            <button class="energy">2</button><br />
            <button class="energy">1</button><br />
            <button class="switch-screen"
                    data-screen="main-screen">Back</button>
        </div>
        <div class="screen" id="eat-screen">
            <button class="eat">Breakfast</button>
            <button class="eat">Lunch</button>
            <button class="eat">Dinner</button>
            <button class="switch-screen"
                    data-screen="main-screen">Back</button>
        </div>
        <div class="screen" id="track-screen">
            <button class="update-qa">Routines</button>
            <button class="update-qa">Subway</button>
            <button class="update-qa">Coding</button>
            <button class="update-qa">E1 Gen</button>
            <button class="update-qa">Drawing</button>
            <button class="update-qa">Cook</button>
            <button class="update-qa">Kitchen</button>
            <button class="update-qa">Tidy</button>
            <button class="update-qa">Relax</button>
            <button class="update-qa">Family</button>
            <button class="update-qa">Walk Other</button>
            <button class="update-qa">Nonfiction</button>
            <button class="update-qa">Laundry</button>
            <button class="update-qa">Sleep</button>
            <button id="goToWeb">Web</button>
            <button class="switch-screen" data-screen="main-screen">Back</button>
        </div>
        <script>
         function updateQuantifiedAwesome(category, note) {
             setWifi(true);
             if (note) {
                 category = category + '|' + note;
             }
             browseURL('http://quantifiedawesome.com/time/track?category=' + encodeURIComponent(category) + '&auth_token=' + global('QATOKEN'));
             hideScene('Test View');
             wait(2000);
         }

         function showFeedback(s) {
             $('#feedback').html(s);
         }
         function switchScreen(s) {
             $('.screen').hide();
             $('#' + s).show();
         }

         $('.switch-screen').click(function() {
             switchScreen($(this).attr('data-screen'));
         });
         function createEvernote(title, body) {
             sendIntent('com.evernote.action.CREATE_NEW_NOTE', 'activity',
                        '', '', 'none', '', '', ['android.intent.extra.TITLE:' + (title || ''), 'android.intent.extra.TEXT:' + (body || '')]);
         }
         $('.note').click(function() {
             createEvernote($(this).text());
         });
         $('.energy').click(function() {
             createEvernote('Energy', 'Energy ' + $(this).text() + ' ');
             switchScreen('main-screen');
         });
         $('#reload').click(function() {
             performTask('Reload Test');
         });
         $('.update-qa').click(function() {
             updateQuantifiedAwesome($(this).attr('data-cat') || $(this).text());
             hideScene('Test View');
         });
         $('#goToWeb').click(function() {
             browseURL('http://quantifiedawesome.com');
         });
         $('.eat').click(function() {
             updateQuantifiedAwesome($(this).text());
             loadApp('MyFitnessPal');
         });
         $('.play').click(function() {
             performTask('Play', null, $(this).text());
         });

         $('#library').click(function() {
             switchScreen('library-screen');
             showFeedback('Attempting to load...');
             $.ajax({url: 'http://quantifiedawesome.com/library_items/current.json?auth_token=' + global('QATOKEN'), success: function(data, status, jq) {
                 showFeedback('Retrieved: ', data.length);
                 if (!data) { return; }
                 var output = '';
                 var today = (new Date()).toISOString().split('T')[0]
                 for (var i = 0; i < data.length; i++) {
                     var classes = '';
                     if (data[i]['dewey'].match(/FICTION/)) {
                         classes = 'fiction';
                     } else {
                         classes = 'nonfiction';
                     }
                     if (data[i]['due'] <= today) {
                         classes += ' due';
                     }
                     output += '<li data-dewey="' + data[i]['dewey'] + '" data-author="'
                             + data[i]['author'] + '" class="' + classes
                             + '"><div class="title">' + data[i]['title'] + '</div>'
                             + '<div class="due-date">' + data[i]['due'] + '</div>'
                             + '</li>';
                 }
                 $('#library-books').html(output);
                 $('#library-books li').click(function() {
                     if ($(this).attr('classes').match(/nonfiction/)) {
                         updateQuantifiedAwesome('Nonfiction', $(this).text());
                     } else {
                         updateQuantifiedAwesome('Play Fiction', $(this).text());
                     }
                     createEvernote('Read: ' + $(this).text() + ' (' + $(this).attr('data-author') + ') -- ' + $(this).attr('data-dewey'));
                 });
             }, error: function(data, status, jq) {
                 showFeedback('Error: ' + data + ' - ' + status);
             }});
         });
         switchScreen('main-screen');

         </script>
    </body>
</html>
